{"ast":null,"code":"var _dec,\n    _class,\n    _jsxFileName = \"C:\\\\Users\\\\carli\\\\OneDrive\\\\Escritorio\\\\Dev\\\\astrid\\\\InteriorDesing\\\\src\\\\Components\\\\SaveLoadModal\\\\SaveFile\\\\SaveModal.jsx\";\n\nimport \"../../../App.css\";\nimport React, { Component } from \"react\";\nimport { inject, observer } from \"mobx-react\";\nimport Modal from \"react-bootstrap/Modal\";\nimport ModalHeading from \"../../ModalHeading.jsx\";\nimport SaveFileList from \"../SaveFileList.jsx\";\nimport Button from \"react-bootstrap/Button\";\nimport axios from \"axios\";\nimport { BASE_URL, FLOOR_MODELS, REMOVE_MODEL, RETRIEVE_MODEL, UPLOAD_ASSET, UPDATE_ASSET_ENTRY, UPDATE_MODEL } from \"../../../Constants\";\nimport LargeAlert from \"../../LargeAlert.jsx\";\nimport $ from \"jquery\";\nlet SaveModal = (_dec = inject(\"store\"), _dec(_class = observer(_class = class SaveModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isDisabled: false,\n      isError: false,\n      fileName: \"\",\n      fileNameTemp: \"\",\n      fileUri: \"\",\n      stateBlob: {},\n      saveFileList: [],\n      showModal: false,\n      copied: false,\n      overwrite: \"Save\"\n    };\n    this.handleClose = this.handleClose.bind(this);\n    this.uploadFile = this.uploadFile.bind(this);\n    this.updateSaveFileList = this.updateSaveFileList.bind(this);\n    this.handleInputChange = this.handleInputChange.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.handleRemove = this.handleRemove.bind(this);\n    this.handleShare = this.handleShare.bind(this);\n  }\n\n  handleClose() {\n    this.props.store.cambiarModuloGuardarArchivo(false);\n    this.setState({\n      fileName: \"\",\n      fileUri: \"\",\n      showModal: false,\n      isError: false\n    });\n  }\n\n  handleShare() {\n    this.setState({\n      copied: true,\n      isError: false\n    });\n  }\n\n  async handleRemove(id) {\n    let token = this.props.store.obtenerTokenDeAcceso;\n    let config = {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    };\n    let body = {\n      _id: id\n    };\n\n    try {\n      await axios.post(BASE_URL + FLOOR_MODELS + REMOVE_MODEL, body, config);\n      this.updateSaveFileList();\n    } catch (e) {\n      console.log(e);\n      this.setState({\n        isError: true\n      });\n    }\n  }\n\n  handleClick(name, uri, event) {\n    this.setState({\n      fileName: name,\n      fileUri: uri,\n      isError: false,\n      overwrite: \"Overwrite\"\n    });\n    $(\".save-file-list-item\").css(\"border-color\", \"#ffffff\");\n    event.currentTarget.style.borderColor = \"#5a6268\";\n  }\n\n  handleInputChange(event) {\n    $(\".save-file-list-item\").css(\"border-color\", \"#ffffff\");\n    this.setState({\n      fileName: event.target.value,\n      fileNameTemp: event.target.value,\n      isError: false,\n      overwrite: \"Save\"\n    });\n  }\n\n  async updateSaveFileList() {\n    let token = this.props.store.obtenerTokenDeAcceso;\n    let config = {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    };\n\n    try {\n      let res = await axios.post(BASE_URL + FLOOR_MODELS + RETRIEVE_MODEL, {}, config);\n      this.setState({\n        saveFileList: res.data,\n        isError: false\n      });\n    } catch (e) {\n      console.log(e);\n      this.setState({\n        isError: true\n      });\n    }\n  }\n\n  async uploadFile(blob) {\n    if (!this.state.isDisabled && this.state.fileName !== \"\") {\n      const data = new FormData();\n      data.append(\"file\", blob);\n      let token = this.props.store.obtenerTokenDeAcceso;\n      let config = {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      };\n\n      try {\n        let resFileId = await axios.post(BASE_URL + UPLOAD_ASSET, data, config);\n        let updateBody = {\n          _id: resFileId.data,\n          fileType: \"floorModel\",\n          extension: \"blueprint3d\"\n        };\n        await axios.post(BASE_URL + UPDATE_ASSET_ENTRY, updateBody, config);\n        let modelBody = {\n          name: this.state.fileName,\n          url: resFileId.data\n        };\n        await axios.post(BASE_URL + FLOOR_MODELS + UPDATE_MODEL, modelBody, config);\n        this.setState({\n          fileName: \"\",\n          isDisabled: false,\n          isError: false\n        });\n        this.updateSaveFileList();\n        this.handleClose();\n      } catch (e) {\n        console.log(e);\n        this.setState({\n          isDisabled: false,\n          isError: true\n        });\n      }\n    } else {\n      this.setState({\n        isDisabled: false,\n        isError: false\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState, snapShot) {\n    if (prevState.stateBlob !== this.props.blob && this.props.blob !== null && this.props.blob !== \"\" && this.state.isDisabled === false) {\n      this.setState({\n        stateBlob: this.props.blob,\n        isDisabled: true,\n        isError: false,\n        overwrite: \"Save\"\n      });\n      this.uploadFile(this.props.blob);\n    }\n\n    if (this.props.store.mostrarModuloGuardarArchivo && !prevState.showModal) {\n      this.setState({\n        showModal: true,\n        isError: false,\n        overwrite: \"Save\"\n      });\n      this.updateSaveFileList();\n    }\n  }\n\n  render() {\n    const {\n      store\n    } = this.props;\n    return /*#__PURE__*/React.createElement(Modal, {\n      \"aria-labelledby\": \"contained-modal-title-vcenter\",\n      centered: true,\n      show: store.mostrarModuloGuardarArchivo,\n      onHide: () => this.handleClose(),\n      id: \"saveModal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Modal.Header, {\n      closeButton: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Modal.Title, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(ModalHeading, {\n      icon: \"saveFile\",\n      message: \"Save Project\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(Modal.Body, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"login-form-space\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(SaveFileList, {\n      clickFunc: this.handleClick,\n      removeFunc: this.handleRemove,\n      shareFunc: this.handleShare,\n      fileList: this.state.saveFileList,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"save-file-space\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"save-file-text\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 15\n      }\n    }, \"Save As: \"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      name: \"name\",\n      value: this.state.fileNameTemp,\n      className: \"save-file-input\",\n      onChange: this.handleInputChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      variant: \"info\",\n      className: \"login-submit-button\",\n      disabled: this.state.isDisabled,\n      onClick: this.props.clickFunc,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 13\n      }\n    }, this.state.overwrite), this.state.copied && /*#__PURE__*/React.createElement(LargeAlert, {\n      variant: \"success\",\n      message: \"Link Copied to Clipboard\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 15\n      }\n    }), this.state.isError && /*#__PURE__*/React.createElement(LargeAlert, {\n      variant: \"info\",\n      message: \"Some Error Occurred\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 15\n      }\n    }))));\n  }\n\n}) || _class) || _class);\nexport default SaveModal;","map":{"version":3,"sources":["C:/Users/carli/OneDrive/Escritorio/Dev/astrid/InteriorDesing/src/Components/SaveLoadModal/SaveFile/SaveModal.jsx"],"names":["React","Component","inject","observer","Modal","ModalHeading","SaveFileList","Button","axios","BASE_URL","FLOOR_MODELS","REMOVE_MODEL","RETRIEVE_MODEL","UPLOAD_ASSET","UPDATE_ASSET_ENTRY","UPDATE_MODEL","LargeAlert","$","SaveModal","constructor","props","state","isDisabled","isError","fileName","fileNameTemp","fileUri","stateBlob","saveFileList","showModal","copied","overwrite","handleClose","bind","uploadFile","updateSaveFileList","handleInputChange","handleClick","handleRemove","handleShare","store","cambiarModuloGuardarArchivo","setState","id","token","obtenerTokenDeAcceso","config","headers","Authorization","body","_id","post","e","console","log","name","uri","event","css","currentTarget","style","borderColor","target","value","res","data","blob","FormData","append","resFileId","updateBody","fileType","extension","modelBody","url","componentDidUpdate","prevProps","prevState","snapShot","mostrarModuloGuardarArchivo","render","clickFunc"],"mappings":"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","sourcesContent":["import \"../../../App.css\";\r\nimport React, { Component } from \"react\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport Modal from \"react-bootstrap/Modal\";\r\nimport ModalHeading from \"../../ModalHeading.jsx\";\r\nimport SaveFileList from \"../SaveFileList.jsx\";\r\nimport Button from \"react-bootstrap/Button\";\r\nimport axios from \"axios\";\r\nimport {\r\n  BASE_URL,\r\n  FLOOR_MODELS,\r\n  REMOVE_MODEL,\r\n  RETRIEVE_MODEL,\r\n  UPLOAD_ASSET,\r\n  UPDATE_ASSET_ENTRY,\r\n  UPDATE_MODEL,\r\n} from \"../../../Constants\";\r\nimport LargeAlert from \"../../LargeAlert.jsx\";\r\nimport $ from \"jquery\";\r\n\r\n@inject(\"store\")\r\n@observer\r\nclass SaveModal extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isDisabled: false,\r\n      isError: false,\r\n      fileName: \"\",\r\n      fileNameTemp: \"\",\r\n      fileUri: \"\",\r\n      stateBlob: {},\r\n      saveFileList: [],\r\n      showModal: false,\r\n      copied: false,\r\n      overwrite: \"Save\",\r\n    };\r\n\r\n    this.handleClose = this.handleClose.bind(this);\r\n    this.uploadFile = this.uploadFile.bind(this);\r\n    this.updateSaveFileList = this.updateSaveFileList.bind(this);\r\n    this.handleInputChange = this.handleInputChange.bind(this);\r\n    this.handleClick = this.handleClick.bind(this);\r\n    this.handleRemove = this.handleRemove.bind(this);\r\n    this.handleShare = this.handleShare.bind(this);\r\n  }\r\n\r\n  handleClose() {\r\n    this.props.store.cambiarModuloGuardarArchivo(false);\r\n    this.setState({\r\n      fileName: \"\",\r\n      fileUri: \"\",\r\n      showModal: false,\r\n      isError: false,\r\n    });\r\n  }\r\n\r\n  handleShare() {\r\n    this.setState({ copied: true, isError: false });\r\n  }\r\n\r\n  async handleRemove(id) {\r\n    let token = this.props.store.obtenerTokenDeAcceso;\r\n    let config = {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    };\r\n    let body = { _id: id };\r\n    try {\r\n      await axios.post(BASE_URL + FLOOR_MODELS + REMOVE_MODEL, body, config);\r\n      this.updateSaveFileList();\r\n    } catch (e) {\r\n      console.log(e);\r\n      this.setState({ isError: true });\r\n    }\r\n  }\r\n\r\n  handleClick(name, uri, event) {\r\n    this.setState({\r\n      fileName: name,\r\n      fileUri: uri,\r\n      isError: false,\r\n      overwrite: \"Overwrite\",\r\n    });\r\n    $(\".save-file-list-item\").css(\"border-color\", \"#ffffff\");\r\n    event.currentTarget.style.borderColor = \"#5a6268\";\r\n  }\r\n\r\n  handleInputChange(event) {\r\n    $(\".save-file-list-item\").css(\"border-color\", \"#ffffff\");\r\n    this.setState({\r\n      fileName: event.target.value,\r\n      fileNameTemp: event.target.value,\r\n      isError: false,\r\n      overwrite: \"Save\",\r\n    });\r\n  }\r\n\r\n  async updateSaveFileList() {\r\n    let token = this.props.store.obtenerTokenDeAcceso;\r\n    let config = {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    };\r\n    try {\r\n      let res = await axios.post(\r\n        BASE_URL + FLOOR_MODELS + RETRIEVE_MODEL,\r\n        {},\r\n        config\r\n      );\r\n      this.setState({ saveFileList: res.data, isError: false });\r\n    } catch (e) {\r\n      console.log(e);\r\n      this.setState({ isError: true });\r\n    }\r\n  }\r\n\r\n  async uploadFile(blob) {\r\n    if (!this.state.isDisabled && this.state.fileName !== \"\") {\r\n      const data = new FormData();\r\n      data.append(\"file\", blob);\r\n      let token = this.props.store.obtenerTokenDeAcceso;\r\n      let config = {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      };\r\n\r\n      try {\r\n        let resFileId = await axios.post(BASE_URL + UPLOAD_ASSET, data, config);\r\n\r\n        let updateBody = {\r\n          _id: resFileId.data,\r\n          fileType: \"floorModel\",\r\n          extension: \"blueprint3d\",\r\n        };\r\n        await axios.post(BASE_URL + UPDATE_ASSET_ENTRY, updateBody, config);\r\n\r\n        let modelBody = {\r\n          name: this.state.fileName,\r\n          url: resFileId.data,\r\n        };\r\n        await axios.post(\r\n          BASE_URL + FLOOR_MODELS + UPDATE_MODEL,\r\n          modelBody,\r\n          config\r\n        );\r\n\r\n        this.setState({ fileName: \"\", isDisabled: false, isError: false });\r\n        this.updateSaveFileList();\r\n        this.handleClose();\r\n      } catch (e) {\r\n        console.log(e);\r\n        this.setState({ isDisabled: false, isError: true });\r\n      }\r\n    } else {\r\n      this.setState({ isDisabled: false, isError: false });\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapShot) {\r\n    if (\r\n      prevState.stateBlob !== this.props.blob &&\r\n      this.props.blob !== null &&\r\n      this.props.blob !== \"\" &&\r\n      this.state.isDisabled === false\r\n    ) {\r\n      this.setState({\r\n        stateBlob: this.props.blob,\r\n        isDisabled: true,\r\n        isError: false,\r\n        overwrite: \"Save\",\r\n      });\r\n      this.uploadFile(this.props.blob);\r\n    }\r\n\r\n    if (this.props.store.mostrarModuloGuardarArchivo && !prevState.showModal) {\r\n      this.setState({ showModal: true, isError: false, overwrite: \"Save\" });\r\n      this.updateSaveFileList();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { store } = this.props;\r\n    return (\r\n      <Modal\r\n        aria-labelledby=\"contained-modal-title-vcenter\"\r\n        centered\r\n        show={store.mostrarModuloGuardarArchivo}\r\n        onHide={() => this.handleClose()}\r\n        id=\"saveModal\"\r\n      >\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n            <ModalHeading icon=\"saveFile\" message=\"Save Project\" />\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <div className=\"login-form-space\">\r\n            <SaveFileList\r\n              clickFunc={this.handleClick}\r\n              removeFunc={this.handleRemove}\r\n              shareFunc={this.handleShare}\r\n              fileList={this.state.saveFileList}\r\n            />\r\n\r\n            <div className=\"save-file-space\">\r\n              <div className=\"save-file-text\">Save As: </div>\r\n              <input\r\n                type=\"text\"\r\n                name=\"name\"\r\n                value={this.state.fileNameTemp}\r\n                className=\"save-file-input\"\r\n                onChange={this.handleInputChange}\r\n              />\r\n            </div>\r\n\r\n            <Button\r\n              variant=\"info\"\r\n              className=\"login-submit-button\"\r\n              disabled={this.state.isDisabled}\r\n              onClick={this.props.clickFunc}\r\n            >\r\n              {this.state.overwrite}\r\n            </Button>\r\n            {this.state.copied && (\r\n              <LargeAlert\r\n                variant=\"success\"\r\n                message=\"Link Copied to Clipboard\"\r\n              />\r\n            )}\r\n            {this.state.isError && (\r\n              <LargeAlert variant=\"info\" message=\"Some Error Occurred\" />\r\n            )}\r\n          </div>\r\n        </Modal.Body>\r\n      </Modal>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SaveModal;\r\n"]},"metadata":{},"sourceType":"module"}